import{a as J,u as G,b as P}from"./JdModalEntryEmpty.vue_vue_type_style_index_0_scoped_ff055eb7_lang.ldg4oXNy.js";import{G as j,a1 as z,j as O,A as U}from"./framework.Io-i1kqv.js";const H=(T={})=>{const{initialize:A=!0,dragResistance:y=1,triggerReleaseGap:M=800,triggerReleaseMinY:D=100}=T,X=M/2,E={passive:!1},w=J(),l=G(),a=j(null);let c,i;const t=z({startX:0,startY:0,startStamp:0,checkMoveY:0,moveIntercepCount:0,moveY:0,holding:!1,blindRequestFrame:null,blindMomentum:.33,blindTargetY:0,releaseRequestFrame:null,releaseMomentum:.33}),g=e=>{if(!i||t.holding)return;const{clientX:n,clientY:o}=e.touches[0];if(a.value){const{scrollTop:s}=a.value;s===0&&R(n,o)}else R(n,o)},r=e=>{const{startX:n,startY:o}=t,{clientX:s,clientY:b}=e.touches[0],q=Math.abs(n-s),C=Math.abs(o-b),p=b-o;t.moveIntercepCount++,t.checkMoveY=p,q<C&&0<p&&e.preventDefault(),3<t.moveIntercepCount&&(document.removeEventListener("touchmove",r),q<C&&0<p&&(t.startY=b,document.addEventListener("touchmove",u,E)))},u=e=>{e.preventDefault();const{startY:n}=t,o=e.touches[0].clientY;t.blindTargetY=(o-n)/y,d(),I()},F=()=>{d(),document.removeEventListener("touchmove",r),document.removeEventListener("touchmove",u);const{startStamp:e,moveY:n}=t,o=(M-(Date.now()-e))/X,s=Math.max(1,o)*n;D<s?l.close():(h(),S())},m=e=>{0<t.checkMoveY&&e.cancelable&&e.preventDefault()},v=e=>{const n=Math.max(0,e),o=t.moveY;t.moveY=e,o!==0&&o!==n&&(i.style.transform=`translate3d(0, ${n}px, 0)`)},d=()=>{clearTimeout(t.blindRequestFrame),cancelAnimationFrame(t.blindRequestFrame)},I=()=>{t.blindRequestFrame=requestAnimationFrame(L)},L=()=>{const{moveY:e,blindTargetY:n,blindMomentum:o}=t;let s=e+(n-e)*o;Math.abs(n-s)<.05?s=n:t.blindRequestFrame=requestAnimationFrame(L),v(s)},R=(e,n)=>{h(),t.startX=e,t.startY=n,t.startStamp=Date.now(),t.moveIntercepCount=0,document.removeEventListener("touchmove",r),document.addEventListener("touchmove",r,E)},h=()=>{cancelAnimationFrame(t.releaseRequestFrame),t.checkMoveY=0},S=()=>{const{moveY:n,releaseMomentum:o}=t,s=n+(0-n)*o;v(s),1<=n?t.releaseRequestFrame=requestAnimationFrame(S):v(0)},f=()=>{i=l.panelElement,i.style.transition="transform 0ms",document.addEventListener("touchstart",g),document.addEventListener("touchend",F),a.value&&(a.value.addEventListener("touchmove",m),a.value.addEventListener("touchend",m));const e=w.observeModalState().subscribe(n=>{var s;const o=n.modals;t.holding=l.id!==((s=o[o.length-1])==null?void 0:s.id)});c=new P,c.add(e)},Y=()=>{d(),h(),document.removeEventListener("touchstart",g),document.removeEventListener("touchmove",r),document.removeEventListener("touchmove",u),document.removeEventListener("touchend",F),a.value&&(a.value.removeEventListener("touchmove",m),a.value.removeEventListener("touchend",m)),c.unsubscribe(),c=void 0},k=e=>{a.value=e},x=e=>{a.value&&Y(),k(e),f()};return O(()=>{A&&setTimeout(f,1)}),U(()=>{Y()}),{refScrollContainer:a,init:f,destroy:Y,changeScrollContainer:x}};export{H as u};
